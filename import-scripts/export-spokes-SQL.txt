// rewrite much faster use this!

SELECT n.`nid`, n.`type`, n.`uid`, n.`title`, n.`status`, n.`created`, n.`changed`, n.`comment`, ctcp.`field_document_textarea_body_value`, ctcp.`field_tagline_value`, ctcp.`field_pubstat_value`, GROUP_CONCAT(DISTINCT cfaa.`field_additional_authors_uid`) AS `additonal_authors`, GROUP_CONCAT(DISTINCT cfcl.`field_cluster_nid`) AS `cluster_nid`, f.`filename` AS `filename`, GROUP_CONCAT(DISTINCT t.`tid` SEPARATOR ', ') AS `terms`, GROUP_CONCAT(DISTINCT ia.`weight` SEPARATOR ', ') AS `attached_image_order`, GROUP_CONCAT(DISTINCT f2.`filepath` SEPARATOR ', ') AS `attached_image_filepath`
FROM (SELECT *
      FROM `tne_node` 
      WHERE type = 'contributed_pieces') n
JOIN `tne_content_type_contributed_pieces` ctcp
ON n.`nid` = ctcp.`nid`
LEFT JOIN `tne_content_field_additional_authors` cfaa
ON n.`nid` = cfaa.`nid`
LEFT JOIN `tne_content_field_cluster` cfcl
ON n.`nid` = cfcl.`nid`
LEFT JOIN `tne_files` f
ON ctcp.`field_thumbnail_fid`=f.`fid`
LEFT JOIN `tne_term_node` t
ON n.`nid`=t.`nid`
LEFT JOIN `tne_image_attach` ia
ON n.`nid`=ia.`nid`
LEFT JOIN `tne_image` i
ON ia.`iid`=i.`nid`
LEFT JOIN `tne_files` f2
ON i.`fid`=f2.`fid`
WHERE f2.`filename`= '_original'
GROUP BY n.`nid`
ORDER BY n.`nid`



// OLD DON'T USE
SELECT n.`nid`, n.`type`, n.`uid`, n.`title`, n.`status`, n.`created`, n.`changed`, n.`comment`, GROUP_CONCAT(DISTINCT cfaa.`field_additional_authors_uid`) AS `additonal_authors`, GROUP_CONCAT(DISTINCT cfcl.`field_cluster_nid`) AS `cluster_nid`, ctcp.`field_document_textarea_body_value`, ctcp.`field_tagline_value`, ctcp.`field_pubstat_value`, f.`filename` AS `filename`, GROUP_CONCAT(DISTINCT t.`tid` SEPARATOR ', ') AS `terms`
FROM `tne_node` n
LEFT JOIN `tne_content_type_contributed_pieces` ctcp
ON n.`nid` = ctcp.`nid`
LEFT JOIN `tne_content_field_additional_authors` cfaa
ON n.`nid` = cfaa.`nid`
LEFT JOIN `tne_content_field_cluster` cfcl
ON n.`nid` = cfcl.`nid`
LEFT JOIN `tne_files` f
ON ctcp.`field_thumbnail_fid`=f.`fid`
LEFT JOIN `tne_term_node` t
ON n.`nid`=t.`nid`
LEFT JOIN `tne_image_attach` ia
ON n.`nid`=ia.`nid`
LEFT JOIN `tne_files` f2
ON ia.`iid`=f2.`fid`
WHERE n.type = 'contributed_pieces'
GROUP BY n.`nid`
ORDER BY n.`nid`

// with attached images
SELECT n.`nid`, n.`type`, n.`uid`, n.`title`, n.`status`, n.`created`, n.`changed`, n.`comment`, GROUP_CONCAT(DISTINCT cfaa.`field_additional_authors_uid`) AS `additonal_authors`, GROUP_CONCAT(DISTINCT cfcl.`field_cluster_nid`) AS `cluster_nid`, ctcp.`field_document_textarea_body_value`, ctcp.`field_tagline_value`, ctcp.`field_pubstat_value`, f.`filename` AS `filename`, GROUP_CONCAT(DISTINCT t.`tid` SEPARATOR ', ') AS `terms`, GROUP_CONCAT(DISTINCT ia.`weight` SEPARATOR ', ') AS `attached_image_order`, GROUP_CONCAT(DISTINCT f2.`filepath` SEPARATOR ', ') AS `attached_image_filepath`
FROM `tne_node` n
WHERE n.type = 'contributed_pieces'
LEFT JOIN `tne_content_type_contributed_pieces` ctcp
ON n.`nid` = ctcp.`nid`
LEFT JOIN `tne_content_field_additional_authors` cfaa
ON n.`nid` = cfaa.`nid`
LEFT JOIN `tne_content_field_cluster` cfcl
ON n.`nid` = cfcl.`nid`
LEFT JOIN `tne_files` f
ON ctcp.`field_thumbnail_fid`=f.`fid`
LEFT JOIN `tne_term_node` t
ON n.`nid`=t.`nid`
LEFT JOIN `tne_image_attach` ia
ON n.`nid`=ia.`nid`
LEFT JOIN `tne_image` i
ON ia.`iid`=i.`nid`
LEFT JOIN `tne_files` f2
ON i.`fid`=f2.`fid`
WHERE n.`type` = 'contributed_pieces'
GROUP BY n.`nid`
ORDER BY n.`nid`

